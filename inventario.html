<!DOCTYPE html>
<html lang="es">
<head>
<title>Inventario de Productos</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
/* -------------------------------------------------------------------------------------- */
/* ESTILOS CSS COMPLETOS */
/* -------------------------------------------------------------------------------------- */
:root{
    --primary-blue:#1E88E5;
    --primary-dark:#1565C0;
    --dark-gray:#333;
    --border-color:#E0E0E0;
    --shadow-light:0 4px 8px rgba(0, 0, 0, 0.1);
    --light-bg:#F8F9FA;
    --success-color:#4CAF50;
    --warning-color:#FFC107;
    --danger-color:#E53935;
    --button-lotes:#4CAF50;
    --button-lotes-hover:#45A049;
    --button-editar:#FFC107;
    --button-editar-hover:#E0A800;
    --button-a침adir:#1E88E5;
    --button-a침adir-hover:#1565C0;
}
/* Estilos Generales y Navbar */
body{
    font-family:'Open Sans', Arial, sans-serif;
    background-color:#f4f6f9;
    margin:0;
    padding-top:70px;
}
.navbar{
    background-color:var(--primary-blue);
    color:white;
    padding:10px 30px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 2px 4px rgba(0,0,0,0.1);
    position:fixed;
    top:0;
    left:0;
    right:0;
    z-index:1000;
}
.navbar .logo{
    font-family:'Roboto', sans-serif;
    font-size:1.6rem;
    font-weight:700;
    color:white;
    text-decoration:none;
    display:flex;
    align-items:center;
    gap:10px;
}
.nav-menu{list-style:none;display:flex;margin:0;padding:0;align-items:center;}
.nav-menu li{margin-left:25px;}
.nav-menu a{color:white;text-decoration:none;padding:10px 15px;display:block;border-radius:4px;transition:background-color 0.3s;}
.nav-menu a:hover{background-color:var(--primary-dark);}
.dropdown{position:relative;}
.dropbtn{display:flex;align-items:center;gap:5px;}
.dropdown-content{display:none;position:absolute;background-color:white;min-width:220px;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);z-index:100;right:0;border-radius:4px;overflow:hidden;border:1px solid var(--border-color);}
.dropdown-content a{color:var(--dark-gray);padding:12px 16px;text-decoration:none;display:block;text-align:left;font-weight:500;}
.dropdown-content a:hover{background-color:var(--light-bg);}
.dropdown:hover .dropdown-content{display:block;}
.container{
    padding:20px;
    max-width:1200px;
    margin:0 auto;
}
.card{
    background-color:white;
    padding:25px;
    border-radius:10px;
    box-shadow:var(--shadow-light);
    margin-bottom:20px;
}
.card h2{
    font-family:'Roboto', sans-serif;
    color:var(--dark-gray);
    font-weight:500;
    margin-top:0;
}
/* Barra de B칰squeda y Acciones */
.search-bar-container{
    display:flex;
    align-items:center;
    gap:15px;
    margin-bottom:25px;
    padding-bottom:15px;
    border-bottom:1px solid #eee;
}
.input-search-simple{
    flex-grow:1;
    padding:10px 15px;
    border:1px solid #ccc;
    border-radius:6px;
    font-size:1rem;
    transition:border-color 0.3s;
    min-width:200px;
}
.button-action{
    padding:10px 15px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-weight:600;
    transition:background-color 0.3s;
    font-size:0.95rem;
    display:flex;
    align-items:center;
    gap:8px;
    white-space:nowrap;
}
.button-primary{background-color:var(--primary-blue);color:white;}
.button-success-action{background-color:var(--success-color);color:white;}
.button-secondary{background-color:#6C757D;color:white;}
/* Estilos de las Tarjetas de Producto */
.product-grid{
    list-style:none;
    padding:0;
    margin:0;
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
    gap:20px;
    margin-top:20px;
}
.product-card{
    background-color:white;
    border:1px solid var(--border-color);
    border-radius:8px;
    padding:15px;
    display:flex;
    flex-direction:column;
    box-shadow:0 1px 5px rgba(0, 0, 0, 0.05);
    transition:transform 0.2s, box-shadow 0.2s;
    position:relative;
}
.product-card:hover{
    transform:translateY(-3px);
    box-shadow:0 6px 15px rgba(0, 0, 0, 0.1);
}
.product-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    margin-bottom:10px;
}
.product-name{
    font-size:1.15rem;
    font-weight:700;
    color:var(--primary-dark);
    line-height:1.3;
    flex-grow:1;
    margin-right:10px;
}
.alerta-receta-badge{
    background-color:var(--warning-color);
    color:var(--dark-gray);
    padding:4px 8px;
    border-radius:4px;
    font-size:0.75rem;
    font-weight:700;
    white-space:nowrap;
    align-self:flex-start;
}
.product-details{
    display:block;
    font-size:0.88rem;
    color:#555;
    margin-bottom:15px;
}
.detail-item{
    display:flex;
    align-items:center;
    gap:6px;
    margin-bottom:4px;
}
.detail-item strong{
    color:var(--dark-gray);
    font-weight:600;
}
.stock-info{
    font-size:1rem;
    font-weight:700;
    color:var(--success-color);
    background-color:#E8F5E9;
    padding:8px 10px;
    border-radius:6px;
    text-align:center;
    margin-top:10px;
    margin-bottom:15px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
}
.stock-bajo{
    color:var(--danger-color);
    background-color:#FFEBEE;
}
.product-actions-footer{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
    margin-top:auto;
    padding-top:10px;
    border-top:1px solid #eee;
}
.product-actions-footer button{
    padding:8px 12px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:600;
    transition:background-color 0.2s, transform 0.1s;
    font-size:0.85rem;
    display:flex;
    align-items:center;
    gap:5px;
    flex-grow:1;
    justify-content:center;
}
.btn-lotes-card{background-color:var(--button-lotes);color:white;}
/* Estilos para Modales */
.modal{display:none;position:fixed;z-index:1001;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.4);padding-top:50px;}
.modal-content{background-color:#fefefe;margin:auto;padding:20px;border:1px solid #888;width:90%;max-width:800px;border-radius:8px;box-shadow:0 4px 8px rgba(0, 0, 0, 0.2);}
.modal-content label{display:block;margin-top:10px;font-weight:bold;color:#333;font-size:0.95rem;}
.modal-content input[type="text"], .modal-content input[type="number"], .modal-content input[type="date"], .modal-content textarea{width:100%;padding:8px;margin-top:5px;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;}
.form-row{display:flex;gap:20px;margin-top:10px;flex-wrap:wrap;}
.form-column{flex:1;min-width:280px;}
.checkbox-group{margin-top:25px;padding:8px;background-color:#f0f8ff;border-radius:4px;border:1px dashed #007bff;}
.modal-footer{display:flex;justify-content:flex-end;gap:10px;margin-top:20px;padding-top:15px;border-top:1px solid #eee;}
.btn-cancelar{background-color:#6c757d;color:white;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;}
.lote-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px dashed #eee;font-size:0.9rem;}
/* Estilo para los botones dentro del modal lotes */
.lote-actions button {
    margin-left: 8px;
    padding: 6px 10px;
    font-size: 0.8rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
}
.btn-editar-lote { background-color: var(--button-editar); color: var(--dark-gray); }
.btn-eliminar-lote { background-color: var(--danger-color); color: white; }

/* ESTILO CLAVE PARA EL INDICADOR DE CARGA */
#loading-indicator {
    font-size: 1.1rem;
    color: var(--primary-blue);
    text-align: center;
    padding: 30px;
}
/* ESTILO PARA SUGERENCIAS */
#nombre-container {
    position: relative;
}
#nombre-sugerencias {
    position: absolute;
    z-index: 10;
    width: 100%;
    max-height: 150px;
    overflow-y: auto;
    background: white;
    border: 1px solid #ccc;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    list-style: none;
    padding: 0;
    margin: 0;
}
#nombre-sugerencias li {
    padding: 10px;
    cursor: pointer;
}
#nombre-sugerencias li:hover {
    background-color: #f0f0f0;
}
.producto-existente {
    background-color: #d4edda;
    border-left: 4px solid #4CAF50;
    font-weight: bold;
}
.producto-nuevo {
    background-color: #fff3cd;
    border-left: 4px solid #FFC107;
}
/* -------------------------------------------------------------------------------------- */
</style>
</head>
<body>
<header>
    <nav class="navbar">
        <a href="ventas_dashboard.html" class="logo">
            FARMACIA JERUSAL칄N
        </a>
        <ul class="nav-menu">
            <li><a href="index.html">Inicio</a></li>
            <li><a href="ventas_dashboard.html">Dashboard</a></li>
            <li class="dropdown">
                <a href="#" class="dropbtn">M칩dulos <i class="fas fa-caret-down"></i></a>
                <div class="dropdown-content">
                    <a href="ventas.html">Ventas <i class="fas fa-cash-register" style="float: right;"></i></a>
                    <a href="inventario.html">Inventario <i class="fas fa-boxes" style="float: right;"></i></a>
                    <a href="facturas.html">Facturas por Pagar <i class="fas fa-file-invoice-dollar" style="float: right;"></i></a>
                    <a href="vencimientos.html">Alerta Vencimientos <i class="fas fa-calendar-times" style="float: right;"></i></a>
                </div>
            </li>
        </ul>
    </nav>
</header>
<div class="container">
    <div class="card inventory-main-card">
        <h2>Gesti칩n de Inventario de Productos 游눍</h2>
        <div class="search-bar-container">
            <input type="text" id="buscar" placeholder="Buscar producto por nombre, marca o SKU..." class="input-search-simple">
            <button class="button-action button-secondary" id="btn-descargar-inventario"><i class="fas fa-download"></i> Descargar Inventario</button>
            <button class="button-action button-secondary" id="btn-carga-masiva">Carga Masiva</button>
            <button class="button-action button-primary" id="btn-nuevo-producto">Nuevo Producto</button>
        </div>

        <h3>Listado de Productos</h3>

        <div id="loading-indicator">
            <i class="fas fa-spinner fa-spin"></i> Cargando datos de inventario... Por favor, espere.
        </div>

        <ul id="lista-inventario" class="product-grid" style="display: none;">
            </ul>
    </div>
</div>

<div id="modal-producto" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modal-title">Ingresar Nuevo Producto/Lote</h2>
        <form id="form-producto">
            <input type="hidden" id="producto-id" value="">
            
            <div class="form-row">
                <div class="form-column" id="nombre-container">
                    <label for="nombre">Nombre de Producto/Lote (*)</label>
                    <input type="text" id="nombre" required>
                    <ul id="nombre-sugerencias"></ul>
                </div>
                <div class="form-column">
                    <label for="marca">Marca</label>
                    <input type="text" id="marca">
                </div>
            </div>

            <div class="form-row">
                <div class="form-column">
                    <label for="ubicacion">Ubicaci칩n (Ej: 1A IZQ)</label>
                    <input type="text" id="ubicacion">
                </div>
                <div class="form-column">
                    <label for="vencimiento">Fecha de Vencimiento</label>
                    <input type="date" id="vencimiento">
                </div>
            </div>

            <div class="form-row">
                <div class="form-column">
                    <label for="stock">Stock/Cantidad (*)</label>
                    <input type="number" id="stock" required min="0">
                </div>
                <div class="form-column checkbox-group">
                    <input type="checkbox" id="antibiotico">
                    <label for="antibiotico" style="display: inline;">Marca como Antibi칩tico (Antibi칩tico)</label>
                </div>
            </div>
            
            <h3>Precios de Venta por Lote</h3>
            <div class="form-row">
                <div class="form-column">
                    <label for="precioPublico">Precio P칰blico (Unidad/Caja, si aplica)</label>
                    <input type="number" id="precioPublico" step="0.01">
                </div>
                <div class="form-column">
                    <label for="precioUnidad">Precio por Unidad (Ej: pastilla)</label>
                    <input type="number" id="precioUnidad" step="0.01">
                </div>
            </div>
            <div class="form-row">
                <div class="form-column">
                    <label for="precioCapsula">Precio por C치psula</label>
                    <input type="number" id="precioCapsula" step="0.01">
                </div>
                <div class="form-column">
                    <label for="precioTableta">Precio por Tableta</label>
                    <input type="number" id="precioTableta" step="0.01">
                </div>
            </div>
            <div class="form-row">
                <div class="form-column">
                    <label for="precioBlister">Precio por Blister</label>
                    <input type="number" id="precioBlister" step="0.01">
                </div>
                <div class="form-column">
                    <label for="precioCaja">Precio por Caja/Display</label>
                    <input type="number" id="precioCaja" step="0.01">
                </div>
            </div>


            <div class="modal-footer">
                <button type="button" class="btn-cancelar" id="btn-cancelar-modal">Cancelar</button>
                <button type="submit" class="button-action button-primary">Guardar Lote</button>
            </div>
        </form>
    </div>
</div>

<div id="modal-carga-masiva" class="modal">
    <div class="modal-content">
        <span class="close" id="close-masiva">&times;</span>
        <h2>Carga Masiva de Lotes (CSV/Excel)</h2>
        <p>1. <button id="btn-descargar-plantilla" class="button-action button-secondary" style="display:inline-flex; padding:5px 10px;">Descargar Plantilla</button> y ll칠nela con los datos de sus lotes.</p>
        <p>2. Copie el contenido de las celdas (incluyendo encabezados si lo desea) y p칠guelo en el campo de texto a continuaci칩n.</p>
        <textarea id="datos-masivos" rows="10" placeholder="Pega aqu칤 los datos de tu inventario separados por comas (CSV)"></textarea>
        <div class="modal-footer">
            <button type="button" class="btn-cancelar" id="btn-cancelar-masiva">Cancelar</button>
            <button type="button" class="button-action button-success-action" id="btn-procesar-masiva">Procesar Carga</button>
        </div>
    </div>
</div>

<div id="modal-lotes" class="modal">
    <div class="modal-content">
        <span class="close" id="close-lotes">&times;</span>
        <h2 id="lotes-title" data-nombre-producto=""></h2>
        <div id="lotes-lista">
            </div>
        <div class="modal-footer">
            <button type="button" class="button-action button-primary" id="btn-agregar-lote">A침adir Nuevo Lote</button>
            <button type="button" class="btn-cancelar" id="btn-cerrar-lotes">Cerrar</button>
        </div>
    </div>
</div>

<script type="module" src="firebase-config.js"></script>
<script type="module" src="inventario.js"></script>
</body>
</html>